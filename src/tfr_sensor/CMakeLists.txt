# If you're having trouble getting your things to build, visit the ROS
# tutorials at <http://wiki.ros.org/ROS/Tutorials> and also read the ROS
# CMake documentation at <http://wiki.ros.org/catkin/CMakeLists.txt>.

cmake_minimum_required(VERSION 2.8.3)
project(tfr_sensor)

add_compile_options(-std=c++14)

find_package(OpenCV 3.4.6 REQUIRED)

find_package(catkin REQUIRED COMPONENTS
    cv_bridge
    roscpp
    tf
    tf2
    tf2_ros
    tf2_geometry_msgs
    actionlib
    geometry_msgs
    sensor_msgs
    std_srvs
    nav_msgs
    tfr_msgs
    tfr_utilities
    robot_localization
    image_transport
)

catkin_package(
    INCLUDE_DIRS include include/
    LIBRARIES tfr_sensor tread_distance_publisher
#  CATKIN_DEPENDS roscpp sensor_msgs cv_bridge
#  DEPENDS OpenCV
)

include_directories(
  include/
  ${catkin_INCLUDE_DIRS}
  ${GTEST_INCLUDE_DIRS}
)


add_executable(image_topic_wrapper ./src/image_topic_wrapper.cpp)
add_dependencies(image_topic_wrapper ${catkin_EXPORTED_TARGETS})
target_link_libraries(image_topic_wrapper ${catkin_LIBRARIES})

add_executable(light_detection_action_server ./src/light_detection_action_server.cpp)
target_link_libraries(light_detection_action_server ${catkin_LIBRARIES})

add_executable(sensor_tilt ./src/sensor_tilt.cpp)
add_dependencies(sensor_tilt ${catkin_EXPORTED_TARGETS})
target_link_libraries(sensor_tilt ${catkin_LIBRARIES})

add_executable(fiducial_odom_publisher src/fiducial_odom_publisher.cpp)
add_dependencies(fiducial_odom_publisher ${catkin_EXPORTED_TARGETS})
target_link_libraries(fiducial_odom_publisher tf_manipulator ${catkin_LIBRARIES})

add_executable(drivebase_odom_publisher src/drivebase_odom_publisher.cpp)
add_dependencies(drivebase_odom_publisher ${catkin_EXPORTED_TARGETS})
target_link_libraries(drivebase_odom_publisher tf_manipulator ${catkin_LIBRARIES})

add_library(tread_distance_publisher_lib src/tread_distance_publisher.cpp)
add_dependencies(tread_distance_publisher_lib ${catkin_EXPORTED_TARGETS})
target_link_libraries(tread_distance_publisher_lib  ${catkin_LIBRARIES})
add_executable(tread_distance_publisher src/tread_distance_publisher.cpp)
target_link_libraries(tread_distance_publisher tread_distance_publisher_lib)


SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -pthread")

if(CATKIN_ENABLE_TESTING)
  find_package(GTest REQUIRED)
  catkin_add_gtest(tread_distance_test test/test_tread_distance_publisher.cpp)
  if(TARGET tread_distance_test)
    target_link_libraries(tread_distance_test tread_distance_publisher_lib)
  endif()

  find_package(rostest REQUIRED)
  add_rostest_gtest(test_drivebase_odom_integration test/drivebase_odom.test test/test_drivebase_odom_integration.cpp)
  if(TARGET test_drivebase_odom_integration)
    target_link_libraries(test_drivebase_odom_integration ${catkin_LIBRARIES})
  endif()
endif()

if(TARGET ${PROJECT_NAME}-test)
  target_link_libraries(${PROJECT_NAME}-test ${PROJECT_NAME}_library)
endif()
